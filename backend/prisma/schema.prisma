// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String  @id @default(uuid())
  email             String? @unique
  anonymous_id      String? @unique
  gender            String? // 'male' or 'female'
  genre_preference  String? // 'modern', 'ancient', 'fantasy', 'urban', 'business'
  emotion_preference String? // 'favored', 'revenge', 'satisfaction', 'growth'
  push_token_ios    String?
  push_token_android String?
  is_onboarded      Int     @default(0)
  is_premium        Int     @default(0)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  // Relations
  daily_contents       DailyContent[]
  user_photos          UserPhoto[]
  content_generations  ContentGeneration[]

  @@index([email])
  @@index([anonymous_id])
}

model DailyContent {
  id          String   @id @default(uuid())
  user_id     String
  text        String   @db.Text
  image_url   String   @db.Text
  date        String   // YYYY-MM-DD format
  delivered_at DateTime?
  created_at  DateTime @default(now())

  // Relations
  user     User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  feedback Feedback?

  @@unique([user_id, date])
  @@index([user_id, date])
}

model Feedback {
  id         String   @id @default(uuid())
  content_id String   @unique
  rating     String   // 'like', 'neutral', 'dislike'
  created_at DateTime @default(now())

  // Relations
  content DailyContent @relation(fields: [content_id], references: [id], onDelete: Cascade)

  @@index([content_id])
}

model UserPhoto {
  id        String   @id @default(uuid())
  user_id   String
  photo_url String   @db.Text
  is_active Int      @default(1)
  created_at DateTime @default(now())

  // Relations
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model ContentGeneration {
  id             String   @id @default(uuid())
  user_id        String
  generated_date String   // YYYY-MM-DD format
  created_at     DateTime @default(now())

  // Relations
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id, generated_date])
}
